{"code":"!function(t){var n={};function i(a){if(n[a])return n[a].exports;var e=n[a]={i:a,l:!1,exports:{}};return t[a].call(e.exports,e,e.exports,i),e.l=!0,e.exports}i.m=t,i.c=n,i.d=function(t,n,a){i.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:a})},i.r=function(t){Object.defineProperty(t,\"__esModule\",{value:!0})},i.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(n,\"a\",n),n},i.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},i.p=\"\",i.w={},i(i.s=0)}([function(t,n,i){\"use strict\";i.r(n);const a={};function e(){return a}const r=!0;const o={database:\"base\",user:\"postgres\",password:\"12345\",host:\"localhost\",port:5432};function s(t,n,i,a){const s=new(e().pg.Client)({user:o.user,host:o.host,database:o.database,password:o.password,port:o.port});s.connect(),!0===r&&(console.log(\"   \"),console.log(t),console.log(\"----------------------------------------\")),s.query(t,n,(t,n)=>{s.end(),t?a():i(n.rows)})}function c(t,n,i){const a=[];t.on(\"data\",t=>{a.push(t.toString())}).on(\"end\",()=>{const t=a.join(\"\");try{const a=JSON.parse(t.toString());i(a)}catch(t){n.end(JSON.stringify({result:\"JSON_ERROR\"}))}})}function d(t){t.get(\"/api/database/clear\",function(t,n){!function(t,n){s(e().fs.readFileSync(\"main.sql\",\"utf8\").toString(),[],()=>{n.end(JSON.stringify({result:\"INIT_DATABASE_OK\"}))},()=>{throw new Error})}(0,n)}),t.get(\"/api/database/:table/select\",function(t,n){!function(t,n){const i=t.params.table.toString();s(\" SELECT * FROM \"+i+\" ORDER BY \"+i+\"_id DESC; \",[],t=>{n.end(JSON.stringify(t))},()=>{n.end(JSON.stringify({result:\"TABLE_NOT_FOUND\"}))})}(t,n)}),t.post(\"/api/database/country/add\",function(t,n){!function(t,n){c(t,n,t=>{s(\"INSERT INTO country (country_name) VALUES ($1) RETURNING *; \",[t.country_name],t=>{const i=t[0];n.end(JSON.stringify(i))},()=>{n.end(JSON.stringify({result:\"COUNTRY_ALREADY_EXISTS\"}))})})}(t,n)}),t.post(\"/api/database/city/add\",function(t,n){!function(t,n){c(t,n,t=>{s(\"INSERT INTO city (city_name, city_country_id) VALUES($1, $2) RETURNING *; \",[t.city_name,parseInt(t.city_country_id)],t=>{const i=t[0];n.end(JSON.stringify(i))},()=>{n.end(JSON.stringify({result:\"COUNTRY_NOT_FOUND\"}))})})}(t,n)}),t.post(\"/api/database/airport/add\",function(t,n){!function(t,n){c(t,n,t=>{s(\"INSERT INTO airport (airport_name, airport_city_id) VALUES ($1, $2) RETURNING *; \",[t.airport_name,parseInt(t.airport_city_id)],t=>{const i=t[0];n.end(JSON.stringify(i))},()=>{n.end(JSON.stringify({result:\"CITY_NOT_FOUND\"}))})})}(t,n)}),t.post(\"/api/database/man/add\",function(t,n){!function(t,n){c(t,n,t=>{s(\"INSERT INTO man (man_fullname, man_city) VALUES ($1, $2) RETURNING *; \",[t.man_fullname,parseInt(t.man_city)],t=>{const i=t[0];n.end(JSON.stringify(i))},()=>{n.end(JSON.stringify({result:\"CITY_NOT_FOUND\"}))})})}(t,n)}),t.post(\"/api/database/ticket/add\",function(t,n){!function(t,n){c(t,n,t=>{s(\"INSERT INTO ticket (ticket_airport_a, ticket_airport_b, ticket_date, ticket_man_id) VALUES ($1, $2, NOW(), $3) RETURNING *; \",[parseInt(t.ticket_airport_a),parseInt(t.ticket_airport_b),parseInt(t.ticket_man_id)],t=>{const i=t[0];n.end(JSON.stringify(i))},()=>{n.end(JSON.stringify({result:\"AIRPORT_OR_MAN_NOT_FOUND\"}))})})}(t,n)}),t.get(\"/api/database/man/:id/get\",function(t,n){!function(t,n){const i=t.params.id.toString();s(\"SELECT * FROM man INNER JOIN city ON (man_city = city_id) INNER JOIN country ON (city_country_id = country_id) WHERE man_id = $1 LIMIT 1; \",[parseInt(i)],t=>{if(0===t.length)n.end(JSON.stringify({result:\"MAN_NOT_EXISTS\"}));else{const i=t[0];n.end(JSON.stringify(i))}},()=>{n.end(JSON.stringify({result:\"DATABASE_ERROR\"}))})}(t,n)}),t.post(\"/api/database/pair/add\",function(t,n){!function(t,n){c(t,n,t=>{s(\"INSERT INTO pair (pair_man_a, pair_man_b) VALUES ($1, $2) RETURNING *; \",[parseInt(t.pair_man_a),parseInt(t.pair_man_b)],t=>{const i=t[0];n.end(JSON.stringify(i))},()=>{n.end(JSON.stringify({result:\"MAN_NOT_FOUND\"}))})})}(t,n)}),t.get(\"/api/database/pair/:id/get\",function(t,n){!function(t,n){const i=t.params.id.toString();s(\"SELECT pair_id, pair_man_a, pair_man_b, m1.man_fullname AS man_1, m2.man_fullname AS man_2 FROM pair INNER JOIN man AS m1 ON (pair_man_a = m1.man_id) INNER JOIN man AS m2 ON (pair_man_b = m2.man_id) WHERE pair_id = $1 LIMIT 1; \",[parseInt(i)],t=>{if(0===t.length)n.end(JSON.stringify({result:\"PAIR_NOT_FOUND\"}));else{const i=t[0];n.end(JSON.stringify(i))}},()=>{n.end(JSON.stringify({result:\"DATABASE_ERROR\"}))})}(t,n)}),t.get(\"/api/database/get_country_by_city_name\",function(t,n){!function(t,n){s(\"SELECT * FROM city INNER JOIN country ON (city_country_id = country_id) WHERE city_name = $1 LIMIT 1; \",[t.query.name],t=>{if(0===t.length)n.end(JSON.stringify({result:\"NOT_FOUND\"}));else{const i=t[0];n.end(JSON.stringify(i))}},()=>{n.end(JSON.stringify({result:\"DATABASE_ERROR\"}))})}(t,n)}),t.get(\"/api/database/get_all_cities_of_country_by_name\",function(t,n){!function(t,n){s(\"SELECT city_id, city_name FROM country INNER JOIN city ON (city_country_id = country_id) WHERE country_name = $1 ORDER BY city_id DESC; \",[t.query.name],t=>{n.end(JSON.stringify(t))},()=>{n.end(JSON.stringify({result:\"DATABASE_ERROR\"}))})}(t,n)}),t.get(\"/api/database/tickets/all/info/select\",function(t,n){!function(t,n){let i=\"SELECT ticket_id, man_fullname, a1.airport_name AS air_1, a2.airport_name AS air_2 FROM ticket \";i+=\"INNER JOIN airport AS a1 ON (ticket_airport_a = a1.airport_id) \",i+=\"INNER JOIN airport AS a2 ON (ticket_airport_b = a2.airport_id) \",i+=\"INNER JOIN man ON (man_id = ticket_man_id) \",s(i+=\"ORDER BY ticket_id DESC; \",[],t=>{n.end(JSON.stringify(t))},()=>{n.end(JSON.stringify({result:\"DATABASE_ERROR\"}))})}(0,n)})}const _=\"http://localhost:5007/\";function u(t,n,i){const a=e().fs;let r=`<!doctype html>\\n        <html>\\n        <head>\\n            <style>\\n                .fieldClass {\\n                    margin-left: 15px;\\n                    padding: 7px;\\n                    width: 300px;\\n                }\\n\\n                body {\\n                    background: #CCCCCC;\\n                }\\n            </style>\\n            <meta charset=\"UTF-8\" />\\n            <title>${t}</title>\\n        </head>\\n        <body>\\n        <h1>${t}</h1>`;r+=`<form id = \"myForm\" action = ${_+i} method = 'POST'>`;for(let t=0;t<n.length;t++)r+=`<p>${n[t]}</p>`,r+=`<input type = \"text\" class = \"fieldClass\" spellcheck = \"false\" autocomplete = \"off\" id = ${n[t]}>`,r+=\"<br>\";r+='<br><input type = \"button\" value = \"Send\" id = \"mainBtn\">',r+=\"</form>\",r+=\"<script src = './code.js'><\\/script>\",r+=\"</body>\\n        </html>\",a.writeFile(\"./static/\"+t+\".html\",r,function(n){console.log(\"Create ./static/\"+t+\".html OK\")})}const p=5007;!function(){let t=i(3)(),n=i(2);e().pg=n;let a=i(1);e().fs=a,t.use(function(t,n,i){n.header(\"Cache-Control\",\"no-cache, no-store, must-revalidate\"),n.header(\"Access-Control-Allow-Origin\",\"*\"),n.header(\"Access-Control-Allow-Headers\",\"Origin, X-Requested-With, Content-Type, Accept\"),i()});const r=parseInt(p);t.listen(r),console.log(\"    \"),console.log(\"Server port: \"+r),console.log(\"-----------------------------------\"),console.log(\"    \"),u(\"addCountry\",[\"country_name\"],\"api/database/country/add\"),u(\"addCity\",[\"city_name\",\"city_country_id\"],\"api/database/city/add\"),u(\"addAirport\",[\"airport_name\",\"airport_city_id\"],\"api/database/airport/add\"),u(\"addMan\",[\"man_fullname\",\"man_city\"],\"api/database/man/add\"),u(\"addTicket\",[\"ticket_airport_a\",\"ticket_airport_b\",\"ticket_man_id\"],\"api/database/ticket/add\"),u(\"addPair\",[\"pair_man_a\",\"pair_man_b\"],\"api/database/pair/add\"),d(t)}(),setTimeout(function(){console.log(\"    \"),console.log(\"-----------------------------------\"),console.log(\"    \"),console.log(\"System is ready to work ...\"),console.log(\"    \")},4e3)},function(t,n){t.exports=require(\"fs\")},function(t,n){t.exports=require(\"pg\")},function(t,n){t.exports=require(\"express\")}]);","extractedComments":[]}