{"code":"!function(t){var n={};function a(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=n,a.d=function(t,n,e){a.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:e})},a.r=function(t){Object.defineProperty(t,\"__esModule\",{value:!0})},a.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(n,\"a\",n),n},a.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},a.p=\"\",a.w={},a(a.s=0)}([function(t,n,a){\"use strict\";a.r(n);const e={};function i(){return e}const o=!0;const r={database:\"base\",user:\"postgres\",password:\"12345\",host:\"localhost\",port:5432};function s(t,n,a,e){const s=new(i().pg.Client)({user:r.user,host:r.host,database:r.database,password:r.password,port:r.port});s.connect(),!0===o&&(console.log(\"   \"),console.log(t),console.log(\"----------------------------------------\")),s.query(t,n,(t,n)=>{s.end(),t?e():a(n.rows)})}function c(t,n,a){const e=[];t.on(\"data\",t=>{e.push(t.toString())}).on(\"end\",()=>{const t=e.join(\"\");try{const e=JSON.parse(t.toString());a(e)}catch(t){n.end(JSON.stringify({result:\"JSON_ERROR\"}))}})}function d(t){t.get(\"/api/database/clear\",function(t,n){!function(t,n){s(i().fs.readFileSync(\"main.sql\",\"utf8\").toString(),[],()=>{n.end(JSON.stringify({result:\"INIT_DATABASE_OK\"}))},()=>{throw new Error})}(0,n)}),t.get(\"/api/database/:table/select\",function(t,n){!function(t,n){const a=t.params.table.toString();s(\" SELECT * FROM \"+a+\" ORDER BY \"+a+\"_id DESC; \",[],t=>{n.end(JSON.stringify(t))},()=>{n.end(JSON.stringify({result:\"TABLE_NOT_FOUND\"}))})}(t,n)}),t.post(\"/api/database/country/add\",function(t,n){!function(t,n){c(t,n,t=>{s(\"INSERT INTO country (country_name) VALUES ($1) RETURNING *; \",[t.country_name],t=>{const a=t[0];n.end(JSON.stringify(a))},()=>{n.end(JSON.stringify({result:\"COUNTRY_ALREADY_EXISTS\"}))})})}(t,n)}),t.post(\"/api/database/city/add\",function(t,n){!function(t,n){c(t,n,t=>{s(\"INSERT INTO city (city_name, city_country_id) VALUES($1, $2) RETURNING *; \",[t.city_name,parseInt(t.city_country_id)],t=>{const a=t[0];n.end(JSON.stringify(a))},()=>{n.end(JSON.stringify({result:\"COUNTRY_NOT_FOUND\"}))})})}(t,n)}),t.post(\"/api/database/airport/add\",function(t,n){!function(t,n){c(t,n,t=>{s(\"INSERT INTO airport (airport_name, airport_city_id) VALUES ($1, $2) RETURNING *; \",[t.airport_name,parseInt(t.airport_city_id)],t=>{const a=t[0];n.end(JSON.stringify(a))},()=>{n.end(JSON.stringify({result:\"CITY_NOT_FOUND\"}))})})}(t,n)}),t.post(\"/api/database/man/add\",function(t,n){!function(t,n){c(t,n,t=>{s(\"INSERT INTO man (man_fullname, man_city) VALUES ($1, $2) RETURNING *; \",[t.man_fullname,parseInt(t.man_city)],t=>{const a=t[0];n.end(JSON.stringify(a))},()=>{n.end(JSON.stringify({result:\"CITY_NOT_FOUND\"}))})})}(t,n)}),t.post(\"/api/database/ticket/add\",function(t,n){!function(t,n){c(t,n,t=>{s(\"INSERT INTO ticket (ticket_airport_a, ticket_airport_b, ticket_date, ticket_man_id) VALUES ($1, $2, NOW(), $3) RETURNING *; \",[parseInt(t.ticket_airport_a),parseInt(t.ticket_airport_b),parseInt(t.ticket_man_id)],t=>{const a=t[0];n.end(JSON.stringify(a))},()=>{n.end(JSON.stringify({result:\"AIRPORT_OR_MAN_NOT_FOUND\"}))})})}(t,n)}),t.get(\"/api/database/man/:id/get\",function(t,n){!function(t,n){const a=t.params.id.toString();s(\"SELECT * FROM man INNER JOIN city ON (man_city = city_id) INNER JOIN country ON (city_country_id = country_id) WHERE man_id = $1 LIMIT 1; \",[parseInt(a)],t=>{if(0===t.length)n.end(JSON.stringify({result:\"MAN_NOT_EXISTS\"}));else{const a=t[0];n.end(JSON.stringify(a))}},()=>{n.end(JSON.stringify({result:\"DATABASE_ERROR\"}))})}(t,n)}),t.post(\"/api/database/pair/add\",function(t,n){!function(t,n){c(t,n,t=>{s(\"INSERT INTO pair (pair_man_a, pair_man_b) VALUES ($1, $2) RETURNING *; \",[parseInt(t.pair_man_a),parseInt(t.pair_man_b)],t=>{const a=t[0];n.end(JSON.stringify(a))},()=>{n.end(JSON.stringify({result:\"MAN_NOT_FOUND\"}))})})}(t,n)}),t.get(\"/api/database/pair/:id/get\",function(t,n){!function(t,n){const a=t.params.id.toString();s(\"WITH m2 AS (SELECT * FROM man) SELECT pair_id, pair_man_a, pair_man_b, m1.man_fullname, m2.man_fullname FROM pair INNER JOIN man AS m1 ON (pair_man_a = m1.man_id) INNER JOIN m2 ON (pair_man_b = m2.man_id) WHERE pair_id = $1 LIMIT 1; \",[parseInt(a)],t=>{if(0===t.length)n.end(JSON.stringify({result:\"PAIR_NOT_FOUND\"}));else{const a=t[0];n.end(JSON.stringify(a))}},()=>{n.end(JSON.stringify({result:\"DATABASE_ERROR\"}))})}(t,n)})}const p=\"http://localhost:5007/\";function l(t,n,a){const e=i().fs;let o=`<!doctype html>\\n        <html>\\n        <head>\\n            <style>\\n                .fieldClass {\\n                    margin-left: 15px;\\n                    padding: 7px;\\n                    width: 300px;\\n                }\\n\\n                body {\\n                    background: #CCCCCC;\\n                }\\n            </style>\\n            <meta charset=\"UTF-8\" />\\n            <title>${t}</title>\\n        </head>\\n        <body>\\n        <h1>${t}</h1>`;o+=`<form id = \"myForm\" action = ${p+a} method = 'POST'>`;for(let t=0;t<n.length;t++)o+=`<p>${n[t]}</p>`,o+=`<input type = \"text\" class = \"fieldClass\" spellcheck = \"false\" autocomplete = \"off\" id = ${n[t]}>`,o+=\"<br>\";o+='<br><input type = \"button\" value = \"Send\" id = \"mainBtn\">',o+=\"</form>\",o+=\"<script src = './code.js'><\\/script>\",o+=\"</body>\\n        </html>\",e.writeFile(\"./static/\"+t+\".html\",o,function(n){console.log(\"Create ./static/\"+t+\".html OK\")})}const _=5007;!function(){let t=a(3)(),n=a(2);i().pg=n;let e=a(1);i().fs=e,t.use(function(t,n,a){n.header(\"Cache-Control\",\"no-cache, no-store, must-revalidate\"),n.header(\"Access-Control-Allow-Origin\",\"*\"),n.header(\"Access-Control-Allow-Headers\",\"Origin, X-Requested-With, Content-Type, Accept\"),a()});const o=parseInt(_);t.listen(o),console.log(\"    \"),console.log(\"Server port: \"+o),console.log(\"-----------------------------------\"),console.log(\"    \"),l(\"addCountry\",[\"country_name\"],\"api/database/country/add\"),l(\"addCity\",[\"city_name\",\"city_country_id\"],\"api/database/city/add\"),l(\"addAirport\",[\"airport_name\",\"airport_city_id\"],\"api/database/airport/add\"),l(\"addMan\",[\"man_fullname\",\"man_city\"],\"api/database/man/add\"),l(\"addTicket\",[\"ticket_airport_a\",\"ticket_airport_b\",\"ticket_man_id\"],\"api/database/ticket/add\"),l(\"addPair\",[\"pair_man_a\",\"pair_man_b\"],\"api/database/pair/add\"),d(t)}(),setTimeout(function(){console.log(\"    \"),console.log(\"-----------------------------------\"),console.log(\"    \"),console.log(\"System is ready to work ...\"),console.log(\"    \")},4e3)},function(t,n){t.exports=require(\"fs\")},function(t,n){t.exports=require(\"pg\")},function(t,n){t.exports=require(\"express\")}]);","extractedComments":[]}