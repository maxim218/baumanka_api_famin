{"code":"!function(t){var n={};function e(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,e),a.l=!0,a.exports}e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.r=function(t){Object.defineProperty(t,\"__esModule\",{value:!0})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,\"a\",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p=\"\",e.w={},e(e.s=0)}([function(t,n,e){\"use strict\";e.r(n);const i={};function a(){return i}const r=!0;const o={database:\"base\",user:\"postgres\",password:\"12345\",host:\"localhost\",port:5432};function s(t,n,e,i){const s=new(a().pg.Client)({user:o.user,host:o.host,database:o.database,password:o.password,port:o.port});s.connect(),!0===r&&(console.log(\"   \"),console.log(t),console.log(\"----------------------------------------\")),s.query(t,n,(t,n)=>{s.end(),t?i():e(n.rows)})}function c(t,n,e){const i=[];t.on(\"data\",t=>{i.push(t.toString())}).on(\"end\",()=>{const t=i.join(\"\");try{const i=JSON.parse(t.toString());e(i)}catch(t){n.end(JSON.stringify({result:\"JSON_ERROR\"}))}})}function d(t){t.get(\"/api/database/clear\",function(t,n){!function(t,n){s(a().fs.readFileSync(\"main.sql\",\"utf8\").toString(),[],()=>{n.end(JSON.stringify({result:\"INIT_DATABASE_OK\"}))},()=>{throw new Error})}(0,n)}),t.get(\"/api/database/:table/select\",function(t,n){!function(t,n){const e=t.params.table.toString();s(\" SELECT * FROM \"+e+\" ORDER BY \"+e+\"_id DESC; \",[],t=>{n.end(JSON.stringify(t))},()=>{n.end(JSON.stringify({result:\"TABLE_NOT_FOUND\"}))})}(t,n)}),t.post(\"/api/database/country/add\",function(t,n){!function(t,n){c(t,n,t=>{s(\"INSERT INTO country (country_name) VALUES ($1) RETURNING *; \",[t.country_name],t=>{const e=t[0];n.end(JSON.stringify(e))},()=>{n.end(JSON.stringify({result:\"COUNTRY_ALREADY_EXISTS\"}))})})}(t,n)}),t.post(\"/api/database/city/add\",function(t,n){!function(t,n){c(t,n,t=>{s(\"INSERT INTO city (city_name, city_country_id) VALUES($1, $2) RETURNING *; \",[t.city_name,parseInt(t.city_country_id)],t=>{const e=t[0];n.end(JSON.stringify(e))},()=>{n.end(JSON.stringify({result:\"COUNTRY_NOT_FOUND\"}))})})}(t,n)}),t.post(\"/api/database/airport/add\",function(t,n){!function(t,n){c(t,n,t=>{s(\"INSERT INTO airport (airport_name, airport_city_id) VALUES ($1, $2) RETURNING *; \",[t.airport_name,parseInt(t.airport_city_id)],t=>{const e=t[0];n.end(JSON.stringify(e))},()=>{n.end(JSON.stringify({result:\"CITY_NOT_FOUND\"}))})})}(t,n)}),t.post(\"/api/database/man/add\",function(t,n){!function(t,n){c(t,n,t=>{s(\"INSERT INTO man (man_fullname, man_city) VALUES ($1, $2) RETURNING *; \",[t.man_fullname,parseInt(t.man_city)],t=>{const e=t[0];n.end(JSON.stringify(e))},()=>{n.end(JSON.stringify({result:\"CITY_NOT_FOUND\"}))})})}(t,n)}),t.post(\"/api/database/ticket/add\",function(t,n){!function(t,n){c(t,n,t=>{s(\"INSERT INTO ticket (ticket_airport_a, ticket_airport_b, ticket_date, ticket_man_id) VALUES ($1, $2, NOW(), $3) RETURNING *; \",[parseInt(t.ticket_airport_a),parseInt(t.ticket_airport_b),parseInt(t.ticket_man_id)],t=>{const e=t[0];n.end(JSON.stringify(e))},()=>{n.end(JSON.stringify({result:\"AIRPORT_OR_MAN_NOT_FOUND\"}))})})}(t,n)}),t.get(\"/api/database/man/:id/get\",function(t,n){!function(t,n){const e=t.params.id.toString();s(\"SELECT * FROM man INNER JOIN city ON (man_city = city_id) INNER JOIN country ON (city_country_id = country_id) WHERE man_id = $1 LIMIT 1; \",[parseInt(e)],t=>{if(0===t.length)n.end(JSON.stringify({result:\"MAN_NOT_EXISTS\"}));else{const e=t[0];n.end(JSON.stringify(e))}},()=>{n.end(JSON.stringify({result:\"DATABASE_ERROR\"}))})}(t,n)}),t.post(\"/api/database/pair/add\",function(t,n){!function(t,n){c(t,n,t=>{s(\"INSERT INTO pair (pair_man_a, pair_man_b) VALUES ($1, $2) RETURNING *; \",[parseInt(t.pair_man_a),parseInt(t.pair_man_b)],t=>{const e=t[0];n.end(JSON.stringify(e))},()=>{n.end(JSON.stringify({result:\"MAN_NOT_FOUND\"}))})})}(t,n)}),t.get(\"/api/database/pair/:id/get\",function(t,n){!function(t,n){const e=t.params.id.toString();s(\"SELECT pair_id, pair_man_a, pair_man_b, m1.man_fullname AS man_1, m2.man_fullname AS man_2 FROM pair INNER JOIN man AS m1 ON (pair_man_a = m1.man_id) INNER JOIN man AS m2 ON (pair_man_b = m2.man_id) WHERE pair_id = $1 LIMIT 1; \",[parseInt(e)],t=>{if(0===t.length)n.end(JSON.stringify({result:\"PAIR_NOT_FOUND\"}));else{const e=t[0];n.end(JSON.stringify(e))}},()=>{n.end(JSON.stringify({result:\"DATABASE_ERROR\"}))})}(t,n)}),t.get(\"/api/database/get_country_by_city_name\",function(t,n){!function(t,n){s(\"SELECT * FROM city INNER JOIN country ON (city_country_id = country_id) WHERE city_name = $1 LIMIT 1; \",[t.query.name],t=>{if(0===t.length)n.end(JSON.stringify({result:\"NOT_FOUND\"}));else{const e=t[0];n.end(JSON.stringify(e))}},()=>{n.end(JSON.stringify({result:\"DATABASE_ERROR\"}))})}(t,n)}),t.get(\"/api/database/get_all_cities_of_country_by_name\",function(t,n){!function(t,n){s(\"SELECT city_id, city_name FROM country INNER JOIN city ON (city_country_id = country_id) WHERE country_name = $1 ORDER BY city_id DESC; \",[t.query.name],t=>{n.end(JSON.stringify(t))},()=>{n.end(JSON.stringify({result:\"DATABASE_ERROR\"}))})}(t,n)})}const _=\"http://localhost:5007/\";function u(t,n,e){const i=a().fs;let r=`<!doctype html>\\n        <html>\\n        <head>\\n            <style>\\n                .fieldClass {\\n                    margin-left: 15px;\\n                    padding: 7px;\\n                    width: 300px;\\n                }\\n\\n                body {\\n                    background: #CCCCCC;\\n                }\\n            </style>\\n            <meta charset=\"UTF-8\" />\\n            <title>${t}</title>\\n        </head>\\n        <body>\\n        <h1>${t}</h1>`;r+=`<form id = \"myForm\" action = ${_+e} method = 'POST'>`;for(let t=0;t<n.length;t++)r+=`<p>${n[t]}</p>`,r+=`<input type = \"text\" class = \"fieldClass\" spellcheck = \"false\" autocomplete = \"off\" id = ${n[t]}>`,r+=\"<br>\";r+='<br><input type = \"button\" value = \"Send\" id = \"mainBtn\">',r+=\"</form>\",r+=\"<script src = './code.js'><\\/script>\",r+=\"</body>\\n        </html>\",i.writeFile(\"./static/\"+t+\".html\",r,function(n){console.log(\"Create ./static/\"+t+\".html OK\")})}const l=5007;!function(){let t=e(3)(),n=e(2);a().pg=n;let i=e(1);a().fs=i,t.use(function(t,n,e){n.header(\"Cache-Control\",\"no-cache, no-store, must-revalidate\"),n.header(\"Access-Control-Allow-Origin\",\"*\"),n.header(\"Access-Control-Allow-Headers\",\"Origin, X-Requested-With, Content-Type, Accept\"),e()});const r=parseInt(l);t.listen(r),console.log(\"    \"),console.log(\"Server port: \"+r),console.log(\"-----------------------------------\"),console.log(\"    \"),u(\"addCountry\",[\"country_name\"],\"api/database/country/add\"),u(\"addCity\",[\"city_name\",\"city_country_id\"],\"api/database/city/add\"),u(\"addAirport\",[\"airport_name\",\"airport_city_id\"],\"api/database/airport/add\"),u(\"addMan\",[\"man_fullname\",\"man_city\"],\"api/database/man/add\"),u(\"addTicket\",[\"ticket_airport_a\",\"ticket_airport_b\",\"ticket_man_id\"],\"api/database/ticket/add\"),u(\"addPair\",[\"pair_man_a\",\"pair_man_b\"],\"api/database/pair/add\"),d(t)}(),setTimeout(function(){console.log(\"    \"),console.log(\"-----------------------------------\"),console.log(\"    \"),console.log(\"System is ready to work ...\"),console.log(\"    \")},4e3)},function(t,n){t.exports=require(\"fs\")},function(t,n){t.exports=require(\"pg\")},function(t,n){t.exports=require(\"express\")}]);","extractedComments":[]}